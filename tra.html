<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±äº¬äº¤é€šãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map { height: 100vh; width: 100%; }
        .vehicle-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: transform 0.3s;
            cursor: pointer;
        }
        .vehicle-icon:hover { transform: scale(1.4); z-index: 10000 !important; }
        .control-panel {
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.95);
            max-height: 90vh;
            overflow-y: auto;
        }
        .stats-card {
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.95);
        }
        .line-item { transition: all 0.2s; }
        .line-item:hover { background: rgba(0,0,0,0.05); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
        .status-live { animation: blink 1s infinite; }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .api-status { font-size: 10px; padding: 2px 6px; border-radius: 4px; }
        .api-ok { background: #10b981; color: white; }
        .api-error { background: #ef4444; color: white; }
        .api-sim { background: #f59e0b; color: white; }
    </style>
</head>
<body class="font-sans">
    <div id="map"></div>
    
    <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
    <div class="control-panel fixed top-4 left-4 p-4 rounded-2xl shadow-xl z-[1000] w-80">
        <h1 class="text-lg font-bold text-gray-800 mb-1 flex items-center gap-2">
            ğŸšƒ æ±äº¬äº¤é€šãƒˆãƒ©ãƒƒã‚«ãƒ¼
        </h1>
        <div class="flex items-center gap-2 mb-3">
            <span id="apiStatus" class="api-status api-sim">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</span>
            <span id="dataSource" class="text-xs text-gray-500"></span>
        </div>
        
        <!-- æ™‚é–“ã‚¹ã‚±ãƒ¼ãƒ«èª¬æ˜ -->
        <div class="bg-blue-50 p-2 rounded-lg mb-3 text-xs">
            <div class="font-bold text-blue-700 mb-1">â±ï¸ æ™‚é–“ã‚¹ã‚±ãƒ¼ãƒ«</div>
            <div class="text-blue-600">
                1x = ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›¸å½“<br>
                60x = 1ç§’ã§1åˆ†é€²ã‚€<br>
                ç¾åœ¨: <span id="timeScaleInfo" class="font-bold">60xï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰</span>
            </div>
        </div>
        
        <!-- ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒˆã‚°ãƒ« -->
        <div class="space-y-2 mb-4">
            <div class="flex gap-2">
                <button id="toggleAllMetro" class="flex-1 text-xs bg-gradient-to-r from-blue-500 to-blue-600 text-white py-1.5 px-2 rounded-lg hover:opacity-90">
                    ğŸš‡ ãƒ¡ãƒˆãƒ­
                </button>
                <button id="toggleAllToei" class="flex-1 text-xs bg-gradient-to-r from-green-500 to-green-600 text-white py-1.5 px-2 rounded-lg hover:opacity-90">
                    ğŸšˆ éƒ½å–¶
                </button>
            </div>
            <div class="flex gap-2">
                <button id="toggleAllJR" class="flex-1 text-xs bg-gradient-to-r from-emerald-500 to-emerald-600 text-white py-1.5 px-2 rounded-lg hover:opacity-90">
                    ğŸšƒ JR
                </button>
                <button id="toggleAllPrivate" class="flex-1 text-xs bg-gradient-to-r from-purple-500 to-purple-600 text-white py-1.5 px-2 rounded-lg hover:opacity-90">
                    ğŸš‹ ç§é‰„
                </button>
            </div>
            <div class="flex gap-2">
                <button id="toggleAllShinkansen" class="flex-1 text-xs bg-gradient-to-r from-cyan-500 to-cyan-600 text-white py-1.5 px-2 rounded-lg hover:opacity-90">
                    ğŸš… æ–°å¹¹ç·š
                </button>
                <button id="toggleAllAirplane" class="flex-1 text-xs bg-gradient-to-r from-orange-500 to-orange-600 text-white py-1.5 px-2 rounded-lg hover:opacity-90">
                    âœˆï¸ é£›è¡Œæ©Ÿ
                </button>
            </div>
        </div>

        <!-- è·¯ç·šä¸€è¦§ -->
        <div id="lineList" class="space-y-1 text-sm max-h-48 overflow-y-auto border-t pt-3">
        </div>
        
        <!-- æ™‚é–“ã‚¹ã‚±ãƒ¼ãƒ«èª¿æ•´ -->
        <div class="mt-4 pt-3 border-t border-gray-200">
            <div class="flex items-center justify-between text-sm text-gray-600 mb-1">
                <span>æ™‚é–“ã‚¹ã‚±ãƒ¼ãƒ«</span>
                <span id="speedLabel" class="font-bold text-blue-600">60x</span>
            </div>
            <input type="range" id="speedControl" min="1" max="120" step="1" value="60" class="w-full accent-blue-500">
            <div class="flex justify-between text-xs text-gray-400 mt-1">
                <span>1x (å®Ÿæ™‚é–“)</span>
                <span>120x (2åˆ†/ç§’)</span>
            </div>
        </div>
        
        <div class="flex gap-2 mt-3">
            <button id="resetView" class="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-2 px-3 rounded-lg hover:opacity-90 transition text-sm font-medium">
                ğŸ—¾ æ±äº¬å…¨ä½“
            </button>
            <button id="hideAllLines" class="flex-1 bg-gray-200 text-gray-700 py-2 px-3 rounded-lg hover:bg-gray-300 transition text-sm font-medium">
                å…¨éè¡¨ç¤º
            </button>
        </div>
    </div>
    
    <!-- çµ±è¨ˆãƒ‘ãƒãƒ« -->
    <div class="stats-card fixed bottom-4 left-4 p-4 rounded-2xl shadow-xl z-[1000]">
        <div class="flex gap-6">
            <div class="text-center">
                <div id="totalVehicles" class="text-2xl font-bold text-gray-800">0</div>
                <div class="text-xs text-gray-500">é‹è¡Œè»Šä¸¡</div>
            </div>
            <div class="text-center border-l pl-6">
                <div id="totalLines" class="text-2xl font-bold text-gray-800">0</div>
                <div class="text-xs text-gray-500">è·¯ç·šæ•°</div>
            </div>
            <div class="text-center border-l pl-6">
                <div id="currentTime" class="text-2xl font-bold text-gray-800">--:--</div>
                <div class="text-xs text-gray-500">ç¾åœ¨æ™‚åˆ»</div>
            </div>
        </div>
    </div>

    <!-- æƒ…å ±ãƒ‘ãƒãƒ« -->
    <div class="stats-card fixed bottom-4 right-4 p-3 rounded-xl shadow-xl z-[1000] text-xs max-w-xs">
        <div class="text-gray-600 font-medium mb-2">ğŸ“ é€Ÿåº¦ã«ã¤ã„ã¦</div>
        <div class="text-gray-500 space-y-1">
            <div>â€¢ åœ°ä¸‹é‰„/JR: ç´„40km/hï¼ˆå¹³å‡ï¼‰</div>
            <div>â€¢ æ–°å¹¹ç·š: ç´„250km/h</div>
            <div>â€¢ é£›è¡Œæ©Ÿ: ç´„800km/h</div>
            <div class="text-blue-600 mt-2 font-medium">
                â€» é§…é–“è·é›¢ã¨å®Ÿéš›ã®æ‰€è¦æ™‚é–“ã‹ã‚‰<br>è¨ˆç®—ã—ãŸç¾å®Ÿçš„ãªé€Ÿåº¦ã§ã™
            </div>
        </div>
        <div class="border-t mt-2 pt-2 text-gray-400">
            <div>ğŸ’¡ 1x=ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›¸å½“</div>
            <div>60xã§1åˆ†ãŒ1ç§’ã§é€²ã¿ã¾ã™</div>
        </div>
    </div>

    <script>
        // ========================================
        // è¨­å®š
        // ========================================
        const CONFIG = {
            // æ™‚é–“ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆ1 = ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã€60 = 1ç§’ã§1åˆ†é€²ã‚€ï¼‰
            timeScale: 60,
            
            // æ›´æ–°é–“éš”ï¼ˆãƒŸãƒªç§’ï¼‰
            updateInterval: 100,
            
            // å¹³å‡é€Ÿåº¦ (km/h)
            speeds: {
                metro: 35,      // åœ°ä¸‹é‰„ï¼ˆé§…é–“å«ã‚€å¹³å‡ï¼‰
                toei: 32,       // éƒ½å–¶åœ°ä¸‹é‰„
                jr: 40,         // JRåœ¨æ¥ç·š
                private: 38,    // ç§é‰„
                shinkansen: 220, // æ–°å¹¹ç·šï¼ˆå¹³å‡ï¼‰
                airplane: 800   // é£›è¡Œæ©Ÿ
            }
        };

        // åœ°å›³åˆæœŸåŒ–
        const map = L.map('map').setView([35.6812, 139.7671], 12);
        
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            maxZoom: 19
        }).addTo(map);

        // ãƒ‡ãƒ¼ã‚¿æ ¼ç´
        let vehicles = [];
        let markers = {};
        let routeLines = {};
        let lineVisibility = {};

        // ========================================
        // å®Ÿéš›ã®é§…åº§æ¨™ãƒ‡ãƒ¼ã‚¿ï¼ˆæ±äº¬ã®ä¸»è¦è·¯ç·šï¼‰
        // ========================================
        const railwayData = {
            // æ±äº¬ãƒ¡ãƒˆãƒ­
            metro: {
                ginza: {
                    name: 'éŠ€åº§ç·š',
                    color: '#FF9500',
                    avgTime: 3, // é§…é–“å¹³å‡æ™‚é–“ï¼ˆåˆ†ï¼‰
                    stations: [
                        { name: 'æµ…è‰', lat: 35.7112, lng: 139.7964 },
                        { name: 'ç”°åŸç”º', lat: 35.7101, lng: 139.7907 },
                        { name: 'ç¨²è·ç”º', lat: 35.7074, lng: 139.7829 },
                        { name: 'ä¸Šé‡', lat: 35.7078, lng: 139.7749 },
                        { name: 'ä¸Šé‡åºƒå°è·¯', lat: 35.7073, lng: 139.7622 },
                        { name: 'æœ«åºƒç”º', lat: 35.6988, lng: 139.7730 },
                        { name: 'ç¥ç”°', lat: 35.6915, lng: 139.7636 },
                        { name: 'ä¸‰è¶Šå‰', lat: 35.6867, lng: 139.7639 },
                        { name: 'æ—¥æœ¬æ©‹', lat: 35.6813, lng: 139.7652 },
                        { name: 'äº¬æ©‹', lat: 35.6750, lng: 139.7639 },
                        { name: 'éŠ€åº§', lat: 35.6719, lng: 139.7582 },
                        { name: 'æ–°æ©‹', lat: 35.6627, lng: 139.7573 },
                        { name: 'è™ãƒé–€', lat: 35.6583, lng: 139.7516 },
                        { name: 'æºœæ± å±±ç‹', lat: 35.6738, lng: 139.7414 },
                        { name: 'èµ¤å‚è¦‹é™„', lat: 35.6769, lng: 139.7366 },
                        { name: 'é’å±±ä¸€ä¸ç›®', lat: 35.6723, lng: 139.7234 },
                        { name: 'å¤–è‹‘å‰', lat: 35.6654, lng: 139.7122 },
                        { name: 'è¡¨å‚é“', lat: 35.6598, lng: 139.7006 },
                        { name: 'æ¸‹è°·', lat: 35.6590, lng: 139.7020 },
                    ]
                },
                marunouchi: {
                    name: 'ä¸¸ãƒå†…ç·š',
                    color: '#F62E36',
                    avgTime: 2,
                    stations: [
                        { name: 'è»çªª', lat: 35.7034, lng: 139.6196 },
                        { name: 'å—é˜¿ä½ãƒ¶è°·', lat: 35.6983, lng: 139.6353 },
                        { name: 'æ–°é«˜å††å¯º', lat: 35.6949, lng: 139.6492 },
                        { name: 'æ±é«˜å††å¯º', lat: 35.6957, lng: 139.6614 },
                        { name: 'æ–°ä¸­é‡', lat: 35.6973, lng: 139.6766 },
                        { name: 'ä¸­é‡å‚ä¸Š', lat: 35.6976, lng: 139.6855 },
                        { name: 'è¥¿æ–°å®¿', lat: 35.6947, lng: 139.6925 },
                        { name: 'æ–°å®¿', lat: 35.6896, lng: 139.6994 },
                        { name: 'æ–°å®¿ä¸‰ä¸ç›®', lat: 35.6880, lng: 139.7087 },
                        { name: 'æ–°å®¿å¾¡è‹‘å‰', lat: 35.6887, lng: 139.7142 },
                        { name: 'å››è°·ä¸‰ä¸ç›®', lat: 35.6870, lng: 139.7217 },
                        { name: 'å››ãƒ„è°·', lat: 35.6860, lng: 139.7300 },
                        { name: 'èµ¤å‚è¦‹é™„', lat: 35.6769, lng: 139.7366 },
                        { name: 'å›½ä¼šè­°äº‹å ‚å‰', lat: 35.6736, lng: 139.7450 },
                        { name: 'éœã‚±é–¢', lat: 35.6737, lng: 139.7510 },
                        { name: 'éŠ€åº§', lat: 35.6750, lng: 139.7639 },
                        { name: 'æ±äº¬', lat: 35.6819, lng: 139.7649 },
                        { name: 'å¤§æ‰‹ç”º', lat: 35.6867, lng: 139.7630 },
                        { name: 'æ·¡è·¯ç”º', lat: 35.6952, lng: 139.7671 },
                        { name: 'å¾¡èŒ¶ãƒæ°´', lat: 35.6998, lng: 139.7651 },
                        { name: 'æœ¬éƒ·ä¸‰ä¸ç›®', lat: 35.7067, lng: 139.7598 },
                        { name: 'å¾Œæ¥½åœ’', lat: 35.7078, lng: 139.7515 },
                        { name: 'èŒ—è·è°·', lat: 35.7177, lng: 139.7284 },
                        { name: 'æ–°å¤§å¡š', lat: 35.7274, lng: 139.7280 },
                        { name: 'æ± è¢‹', lat: 35.7283, lng: 139.7102 },
                    ]
                },
                hibiya: {
                    name: 'æ—¥æ¯”è°·ç·š',
                    color: '#B5B5AC',
                    avgTime: 2,
                    stations: [
                        { name: 'åŒ—åƒä½', lat: 35.7497, lng: 139.8047 },
                        { name: 'å—åƒä½', lat: 35.7324, lng: 139.8007 },
                        { name: 'ä¸‰ãƒè¼ª', lat: 35.7268, lng: 139.7912 },
                        { name: 'å…¥è°·', lat: 35.7200, lng: 139.7852 },
                        { name: 'ä¸Šé‡', lat: 35.7141, lng: 139.7773 },
                        { name: 'ä»²å¾¡å¾’ç”º', lat: 35.7072, lng: 139.7741 },
                        { name: 'ç§‹è‘‰åŸ', lat: 35.6984, lng: 139.7731 },
                        { name: 'å°ä¼é¦¬ç”º', lat: 35.6917, lng: 139.7783 },
                        { name: 'äººå½¢ç”º', lat: 35.6859, lng: 139.7831 },
                        { name: 'èŒ…å ´ç”º', lat: 35.6797, lng: 139.7807 },
                        { name: 'å…«ä¸å €', lat: 35.6744, lng: 139.7769 },
                        { name: 'ç¯‰åœ°', lat: 35.6699, lng: 139.7717 },
                        { name: 'æ±éŠ€åº§', lat: 35.6697, lng: 139.7654 },
                        { name: 'éŠ€åº§', lat: 35.6719, lng: 139.7606 },
                        { name: 'æ—¥æ¯”è°·', lat: 35.6750, lng: 139.7582 },
                        { name: 'éœã‚±é–¢', lat: 35.6737, lng: 139.7510 },
                        { name: 'ç¥è°·ç”º', lat: 35.6644, lng: 139.7444 },
                        { name: 'å…­æœ¬æœ¨', lat: 35.6629, lng: 139.7314 },
                        { name: 'åºƒå°¾', lat: 35.6516, lng: 139.7224 },
                        { name: 'æµæ¯”å¯¿', lat: 35.6467, lng: 139.7108 },
                        { name: 'ä¸­ç›®é»’', lat: 35.6440, lng: 139.6988 },
                    ]
                },
                tozai: {
                    name: 'æ±è¥¿ç·š',
                    color: '#009BBF',
                    avgTime: 2.5,
                    stations: [
                        { name: 'ä¸­é‡', lat: 35.7065, lng: 139.6658 },
                        { name: 'è½åˆ', lat: 35.7141, lng: 139.6854 },
                        { name: 'é«˜ç”°é¦¬å ´', lat: 35.7127, lng: 139.7036 },
                        { name: 'æ—©ç¨²ç”°', lat: 35.7091, lng: 139.7222 },
                        { name: 'ç¥æ¥½å‚', lat: 35.7018, lng: 139.7363 },
                        { name: 'é£¯ç”°æ©‹', lat: 35.7014, lng: 139.7452 },
                        { name: 'ä¹æ®µä¸‹', lat: 35.6955, lng: 139.7513 },
                        { name: 'ç«¹æ©‹', lat: 35.6914, lng: 139.7567 },
                        { name: 'å¤§æ‰‹ç”º', lat: 35.6867, lng: 139.7630 },
                        { name: 'æ—¥æœ¬æ©‹', lat: 35.6813, lng: 139.7744 },
                        { name: 'èŒ…å ´ç”º', lat: 35.6797, lng: 139.7807 },
                        { name: 'é–€å‰ä»²ç”º', lat: 35.6730, lng: 139.7953 },
                        { name: 'æœ¨å ´', lat: 35.6703, lng: 139.8072 },
                        { name: 'æ±é™½ç”º', lat: 35.6694, lng: 139.8177 },
                        { name: 'å—ç ‚ç”º', lat: 35.6711, lng: 139.8361 },
                        { name: 'è¥¿è‘›è¥¿', lat: 35.6594, lng: 139.8547 },
                        { name: 'è‘›è¥¿', lat: 35.6586, lng: 139.8711 },
                        { name: 'æµ¦å®‰', lat: 35.6533, lng: 139.9017 },
                        { name: 'å—è¡Œå¾³', lat: 35.6617, lng: 139.9128 },
                        { name: 'è¡Œå¾³', lat: 35.6717, lng: 139.9228 },
                        { name: 'å¦™å…¸', lat: 35.6789, lng: 139.9331 },
                        { name: 'åŸæœ¨ä¸­å±±', lat: 35.6906, lng: 139.9481 },
                        { name: 'è¥¿èˆ¹æ©‹', lat: 35.7003, lng: 139.9625 },
                    ]
                },
                chiyoda: {
                    name: 'åƒä»£ç”°ç·š',
                    color: '#00BB85',
                    avgTime: 2,
                    stations: [
                        { name: 'ä»£ã€…æœ¨ä¸ŠåŸ', lat: 35.6683, lng: 139.6778 },
                        { name: 'ä»£ã€…æœ¨å…¬åœ’', lat: 35.6700, lng: 139.6897 },
                        { name: 'æ˜æ²»ç¥å®®å‰', lat: 35.6703, lng: 139.7031 },
                        { name: 'è¡¨å‚é“', lat: 35.6654, lng: 139.7122 },
                        { name: 'ä¹ƒæœ¨å‚', lat: 35.6669, lng: 139.7267 },
                        { name: 'èµ¤å‚', lat: 35.6727, lng: 139.7378 },
                        { name: 'å›½ä¼šè­°äº‹å ‚å‰', lat: 35.6736, lng: 139.7450 },
                        { name: 'éœã‚±é–¢', lat: 35.6737, lng: 139.7510 },
                        { name: 'æ—¥æ¯”è°·', lat: 35.6750, lng: 139.7582 },
                        { name: 'äºŒé‡æ©‹å‰', lat: 35.6767, lng: 139.7619 },
                        { name: 'å¤§æ‰‹ç”º', lat: 35.6867, lng: 139.7630 },
                        { name: 'æ–°å¾¡èŒ¶ãƒæ°´', lat: 35.6964, lng: 139.7648 },
                        { name: 'æ¹¯å³¶', lat: 35.7078, lng: 139.7689 },
                        { name: 'æ ¹æ´¥', lat: 35.7177, lng: 139.7622 },
                        { name: 'åƒé§„æœ¨', lat: 35.7272, lng: 139.7597 },
                        { name: 'è¥¿æ—¥æš®é‡Œ', lat: 35.7319, lng: 139.7672 },
                        { name: 'ç”ºå±‹', lat: 35.7436, lng: 139.7819 },
                        { name: 'åŒ—åƒä½', lat: 35.7497, lng: 139.8047 },
                        { name: 'ç¶¾ç€¬', lat: 35.7628, lng: 139.8244 },
                        { name: 'åŒ—ç¶¾ç€¬', lat: 35.7772, lng: 139.8306 },
                    ]
                },
                yurakucho: {
                    name: 'æœ‰æ¥½ç”ºç·š',
                    color: '#C1A470',
                    avgTime: 2,
                    stations: [
                        { name: 'å’Œå…‰å¸‚', lat: 35.7878, lng: 139.6214 },
                        { name: 'åœ°ä¸‹é‰„æˆå¢—', lat: 35.7781, lng: 139.6328 },
                        { name: 'åœ°ä¸‹é‰„èµ¤å¡š', lat: 35.7700, lng: 139.6431 },
                        { name: 'å¹³å’Œå°', lat: 35.7619, lng: 139.6531 },
                        { name: 'æ°·å·å°', lat: 35.7539, lng: 139.6631 },
                        { name: 'å°ç«¹å‘åŸ', lat: 35.7433, lng: 139.6792 },
                        { name: 'åƒå·', lat: 35.7367, lng: 139.6914 },
                        { name: 'è¦ç”º', lat: 35.7322, lng: 139.7017 },
                        { name: 'æ± è¢‹', lat: 35.7283, lng: 139.7102 },
                        { name: 'æ±æ± è¢‹', lat: 35.7258, lng: 139.7189 },
                        { name: 'è­·å›½å¯º', lat: 35.7178, lng: 139.7281 },
                        { name: 'æ±Ÿæˆ¸å·æ©‹', lat: 35.7117, lng: 139.7356 },
                        { name: 'é£¯ç”°æ©‹', lat: 35.7014, lng: 139.7452 },
                        { name: 'å¸‚ã‚±è°·', lat: 35.6914, lng: 139.7436 },
                        { name: 'éº¹ç”º', lat: 35.6844, lng: 139.7389 },
                        { name: 'æ°¸ç”°ç”º', lat: 35.6789, lng: 139.7394 },
                        { name: 'æ¡œç”°é–€', lat: 35.6764, lng: 139.7517 },
                        { name: 'æœ‰æ¥½ç”º', lat: 35.6750, lng: 139.7600 },
                        { name: 'éŠ€åº§ä¸€ä¸ç›®', lat: 35.6722, lng: 139.7656 },
                        { name: 'æ–°å¯Œç”º', lat: 35.6686, lng: 139.7736 },
                        { name: 'æœˆå³¶', lat: 35.6625, lng: 139.7856 },
                        { name: 'è±Šæ´²', lat: 35.6533, lng: 139.7964 },
                        { name: 'è¾°å·³', lat: 35.6453, lng: 139.8106 },
                        { name: 'æ–°æœ¨å ´', lat: 35.6428, lng: 139.8267 },
                    ]
                },
                hanzomon: {
                    name: 'åŠè”µé–€ç·š',
                    color: '#8F76D6',
                    avgTime: 2,
                    stations: [
                        { name: 'æ¸‹è°·', lat: 35.6590, lng: 139.7020 },
                        { name: 'è¡¨å‚é“', lat: 35.6654, lng: 139.7122 },
                        { name: 'é’å±±ä¸€ä¸ç›®', lat: 35.6723, lng: 139.7234 },
                        { name: 'æ°¸ç”°ç”º', lat: 35.6789, lng: 139.7394 },
                        { name: 'åŠè”µé–€', lat: 35.6852, lng: 139.7447 },
                        { name: 'ä¹æ®µä¸‹', lat: 35.6955, lng: 139.7513 },
                        { name: 'ç¥ä¿ç”º', lat: 35.6958, lng: 139.7578 },
                        { name: 'å¤§æ‰‹ç”º', lat: 35.6867, lng: 139.7630 },
                        { name: 'ä¸‰è¶Šå‰', lat: 35.6867, lng: 139.7739 },
                        { name: 'æ°´å¤©å®®å‰', lat: 35.6833, lng: 139.7858 },
                        { name: 'æ¸…æ¾„ç™½æ²³', lat: 35.6808, lng: 139.8008 },
                        { name: 'ä½å‰', lat: 35.6858, lng: 139.8153 },
                        { name: 'éŒ¦ç³¸ç”º', lat: 35.6964, lng: 139.8142 },
                        { name: 'æŠ¼ä¸Š', lat: 35.7106, lng: 139.8136 },
                    ]
                },
                namboku: {
                    name: 'å—åŒ—ç·š',
                    color: '#00AC9B',
                    avgTime: 2,
                    stations: [
                        { name: 'ç›®é»’', lat: 35.6336, lng: 139.7158 },
                        { name: 'ç™½é‡‘å°', lat: 35.6403, lng: 139.7244 },
                        { name: 'ç™½é‡‘é«˜è¼ª', lat: 35.6472, lng: 139.7333 },
                        { name: 'éº»å¸ƒåç•ª', lat: 35.6558, lng: 139.7372 },
                        { name: 'å…­æœ¬æœ¨ä¸€ä¸ç›®', lat: 35.6639, lng: 139.7397 },
                        { name: 'æºœæ± å±±ç‹', lat: 35.6738, lng: 139.7414 },
                        { name: 'æ°¸ç”°ç”º', lat: 35.6789, lng: 139.7394 },
                        { name: 'å››ãƒ„è°·', lat: 35.6860, lng: 139.7300 },
                        { name: 'å¸‚ã‚±è°·', lat: 35.6914, lng: 139.7436 },
                        { name: 'é£¯ç”°æ©‹', lat: 35.7014, lng: 139.7452 },
                        { name: 'å¾Œæ¥½åœ’', lat: 35.7078, lng: 139.7515 },
                        { name: 'æ±å¤§å‰', lat: 35.7175, lng: 139.7592 },
                        { name: 'æœ¬é§’è¾¼', lat: 35.7283, lng: 139.7467 },
                        { name: 'é§’è¾¼', lat: 35.7361, lng: 139.7478 },
                        { name: 'è¥¿ã‚±åŸ', lat: 35.7450, lng: 139.7492 },
                        { name: 'ç‹å­', lat: 35.7536, lng: 139.7381 },
                        { name: 'ç‹å­ç¥è°·', lat: 35.7661, lng: 139.7328 },
                        { name: 'å¿—èŒ‚', lat: 35.7781, lng: 139.7217 },
                        { name: 'èµ¤ç¾½å²©æ·µ', lat: 35.7844, lng: 139.7194 },
                    ]
                },
                fukutoshin: {
                    name: 'å‰¯éƒ½å¿ƒç·š',
                    color: '#9C5E31',
                    avgTime: 2.5,
                    stations: [
                        { name: 'æ¸‹è°·', lat: 35.6590, lng: 139.7020 },
                        { name: 'æ˜æ²»ç¥å®®å‰', lat: 35.6703, lng: 139.7031 },
                        { name: 'åŒ—å‚é“', lat: 35.6786, lng: 139.7039 },
                        { name: 'æ–°å®¿ä¸‰ä¸ç›®', lat: 35.6880, lng: 139.7087 },
                        { name: 'æ±æ–°å®¿', lat: 35.6997, lng: 139.7125 },
                        { name: 'è¥¿æ—©ç¨²ç”°', lat: 35.7122, lng: 139.7142 },
                        { name: 'é›‘å¸ãŒè°·', lat: 35.7214, lng: 139.7092 },
                        { name: 'æ± è¢‹', lat: 35.7283, lng: 139.7102 },
                        { name: 'è¦ç”º', lat: 35.7322, lng: 139.7017 },
                        { name: 'åƒå·', lat: 35.7367, lng: 139.6914 },
                        { name: 'å°ç«¹å‘åŸ', lat: 35.7433, lng: 139.6792 },
                        { name: 'æ°·å·å°', lat: 35.7539, lng: 139.6631 },
                        { name: 'å¹³å’Œå°', lat: 35.7619, lng: 139.6531 },
                        { name: 'åœ°ä¸‹é‰„èµ¤å¡š', lat: 35.7700, lng: 139.6431 },
                        { name: 'åœ°ä¸‹é‰„æˆå¢—', lat: 35.7781, lng: 139.6328 },
                        { name: 'å’Œå…‰å¸‚', lat: 35.7878, lng: 139.6214 },
                    ]
                }
            },
            
            // éƒ½å–¶åœ°ä¸‹é‰„
            toei: {
                asakusa: {
                    name: 'æµ…è‰ç·š',
                    color: '#E85298',
                    avgTime: 2,
                    stations: [
                        { name: 'è¥¿é¦¬è¾¼', lat: 35.5878, lng: 139.7081 },
                        { name: 'é¦¬è¾¼', lat: 35.5939, lng: 139.7128 },
                        { name: 'ä¸­å»¶', lat: 35.6061, lng: 139.7133 },
                        { name: 'æˆ¸è¶Š', lat: 35.6150, lng: 139.7153 },
                        { name: 'äº”åç”°', lat: 35.6258, lng: 139.7236 },
                        { name: 'é«˜è¼ªå°', lat: 35.6350, lng: 139.7331 },
                        { name: 'æ³‰å²³å¯º', lat: 35.6403, lng: 139.7408 },
                        { name: 'ä¸‰ç”°', lat: 35.6506, lng: 139.7469 },
                        { name: 'å¤§é–€', lat: 35.6567, lng: 139.7536 },
                        { name: 'æ–°æ©‹', lat: 35.6658, lng: 139.7594 },
                        { name: 'æ±éŠ€åº§', lat: 35.6697, lng: 139.7654 },
                        { name: 'å®ç”º', lat: 35.6761, lng: 139.7722 },
                        { name: 'æ—¥æœ¬æ©‹', lat: 35.6813, lng: 139.7744 },
                        { name: 'äººå½¢ç”º', lat: 35.6859, lng: 139.7831 },
                        { name: 'æ±æ—¥æœ¬æ©‹', lat: 35.6889, lng: 139.7881 },
                        { name: 'æµ…è‰æ©‹', lat: 35.6972, lng: 139.7883 },
                        { name: 'è”µå‰', lat: 35.7033, lng: 139.7906 },
                        { name: 'æµ…è‰', lat: 35.7112, lng: 139.7964 },
                        { name: 'æœ¬æ‰€å¾å¦»æ©‹', lat: 35.7108, lng: 139.8050 },
                        { name: 'æŠ¼ä¸Š', lat: 35.7106, lng: 139.8136 },
                    ]
                },
                mita: {
                    name: 'ä¸‰ç”°ç·š',
                    color: '#0079C2',
                    avgTime: 2,
                    stations: [
                        { name: 'ç›®é»’', lat: 35.6336, lng: 139.7158 },
                        { name: 'ç™½é‡‘å°', lat: 35.6403, lng: 139.7244 },
                        { name: 'ç™½é‡‘é«˜è¼ª', lat: 35.6472, lng: 139.7333 },
                        { name: 'ä¸‰ç”°', lat: 35.6506, lng: 139.7469 },
                        { name: 'èŠå…¬åœ’', lat: 35.6558, lng: 139.7508 },
                        { name: 'å¾¡æˆé–€', lat: 35.6611, lng: 139.7531 },
                        { name: 'å†…å¹¸ç”º', lat: 35.6700, lng: 139.7539 },
                        { name: 'æ—¥æ¯”è°·', lat: 35.6750, lng: 139.7582 },
                        { name: 'å¤§æ‰‹ç”º', lat: 35.6867, lng: 139.7630 },
                        { name: 'ç¥ä¿ç”º', lat: 35.6958, lng: 139.7578 },
                        { name: 'æ°´é“æ©‹', lat: 35.7019, lng: 139.7536 },
                        { name: 'æ˜¥æ—¥', lat: 35.7086, lng: 139.7508 },
                        { name: 'ç™½å±±', lat: 35.7181, lng: 139.7522 },
                        { name: 'åƒçŸ³', lat: 35.7281, lng: 139.7444 },
                        { name: 'å·£é´¨', lat: 35.7339, lng: 139.7394 },
                        { name: 'è¥¿å·£é´¨', lat: 35.7408, lng: 139.7292 },
                        { name: 'æ–°æ¿æ©‹', lat: 35.7486, lng: 139.7194 },
                        { name: 'æ¿æ©‹åŒºå½¹æ‰€å‰', lat: 35.7561, lng: 139.7106 },
                        { name: 'æ¿æ©‹æœ¬ç”º', lat: 35.7656, lng: 139.7022 },
                        { name: 'æœ¬è“®æ²¼', lat: 35.7739, lng: 139.6972 },
                        { name: 'å¿—æ‘å‚ä¸Š', lat: 35.7817, lng: 139.6894 },
                        { name: 'å¿—æ‘ä¸‰ä¸ç›®', lat: 35.7883, lng: 139.6803 },
                        { name: 'è“®æ ¹', lat: 35.7944, lng: 139.6722 },
                        { name: 'è¥¿å°', lat: 35.7978, lng: 139.6619 },
                        { name: 'é«˜å³¶å¹³', lat: 35.8000, lng: 139.6506 },
                        { name: 'æ–°é«˜å³¶å¹³', lat: 35.7989, lng: 139.6389 },
                        { name: 'è¥¿é«˜å³¶å¹³', lat: 35.7986, lng: 139.6269 },
                    ]
                },
                shinjuku: {
                    name: 'æ–°å®¿ç·š',
                    color: '#6CBB5A',
                    avgTime: 2,
                    stations: [
                        { name: 'æ–°å®¿', lat: 35.6896, lng: 139.6994 },
                        { name: 'æ–°å®¿ä¸‰ä¸ç›®', lat: 35.6880, lng: 139.7087 },
                        { name: 'æ›™æ©‹', lat: 35.6914, lng: 139.7244 },
                        { name: 'å¸‚ãƒ¶è°·', lat: 35.6914, lng: 139.7436 },
                        { name: 'ä¹æ®µä¸‹', lat: 35.6955, lng: 139.7513 },
                        { name: 'ç¥ä¿ç”º', lat: 35.6958, lng: 139.7578 },
                        { name: 'å°å·ç”º', lat: 35.6961, lng: 139.7656 },
                        { name: 'å²©æœ¬ç”º', lat: 35.6953, lng: 139.7761 },
                        { name: 'é¦¬å–°æ¨ªå±±', lat: 35.6914, lng: 139.7839 },
                        { name: 'æµœç”º', lat: 35.6886, lng: 139.7894 },
                        { name: 'æ£®ä¸‹', lat: 35.6883, lng: 139.7978 },
                        { name: 'èŠå·', lat: 35.6878, lng: 139.8072 },
                        { name: 'ä½å‰', lat: 35.6858, lng: 139.8153 },
                        { name: 'è¥¿å¤§å³¶', lat: 35.6867, lng: 139.8269 },
                        { name: 'å¤§å³¶', lat: 35.6867, lng: 139.8397 },
                        { name: 'æ±å¤§å³¶', lat: 35.6903, lng: 139.8519 },
                        { name: 'èˆ¹å €', lat: 35.6833, lng: 139.8697 },
                        { name: 'ä¸€ä¹‹æ±Ÿ', lat: 35.6756, lng: 139.8822 },
                        { name: 'ç‘æ±Ÿ', lat: 35.6719, lng: 139.8942 },
                        { name: 'ç¯ å´', lat: 35.6722, lng: 139.9117 },
                        { name: 'æœ¬å…«å¹¡', lat: 35.7203, lng: 139.9244 },
                    ]
                },
                oedo: {
                    name: 'å¤§æ±Ÿæˆ¸ç·š',
                    color: '#B6007A',
                    avgTime: 2,
                    isLoop: true,
                    stations: [
                        { name: 'éƒ½åºå‰', lat: 35.6911, lng: 139.6919 },
                        { name: 'æ–°å®¿è¥¿å£', lat: 35.6925, lng: 139.6989 },
                        { name: 'æ±æ–°å®¿', lat: 35.6997, lng: 139.7125 },
                        { name: 'è‹¥æ¾æ²³ç”°', lat: 35.7019, lng: 139.7222 },
                        { name: 'ç‰›è¾¼æŸ³ç”º', lat: 35.6994, lng: 139.7322 },
                        { name: 'ç‰›è¾¼ç¥æ¥½å‚', lat: 35.6997, lng: 139.7383 },
                        { name: 'é£¯ç”°æ©‹', lat: 35.7014, lng: 139.7452 },
                        { name: 'æ˜¥æ—¥', lat: 35.7086, lng: 139.7508 },
                        { name: 'æœ¬éƒ·ä¸‰ä¸ç›®', lat: 35.7067, lng: 139.7598 },
                        { name: 'ä¸Šé‡å¾¡å¾’ç”º', lat: 35.7044, lng: 139.7736 },
                        { name: 'æ–°å¾¡å¾’ç”º', lat: 35.7042, lng: 139.7822 },
                        { name: 'è”µå‰', lat: 35.7033, lng: 139.7906 },
                        { name: 'ä¸¡å›½', lat: 35.6964, lng: 139.7936 },
                        { name: 'æ£®ä¸‹', lat: 35.6883, lng: 139.7978 },
                        { name: 'æ¸…æ¾„ç™½æ²³', lat: 35.6808, lng: 139.8008 },
                        { name: 'é–€å‰ä»²ç”º', lat: 35.6730, lng: 139.7953 },
                        { name: 'æœˆå³¶', lat: 35.6625, lng: 139.7856 },
                        { name: 'å‹ã©ã', lat: 35.6572, lng: 139.7772 },
                        { name: 'ç¯‰åœ°å¸‚å ´', lat: 35.6622, lng: 139.7694 },
                        { name: 'æ±ç•™', lat: 35.6611, lng: 139.7614 },
                        { name: 'å¤§é–€', lat: 35.6567, lng: 139.7536 },
                        { name: 'èµ¤ç¾½æ©‹', lat: 35.6536, lng: 139.7456 },
                        { name: 'éº»å¸ƒåç•ª', lat: 35.6558, lng: 139.7372 },
                        { name: 'å…­æœ¬æœ¨', lat: 35.6629, lng: 139.7314 },
                        { name: 'é’å±±ä¸€ä¸ç›®', lat: 35.6723, lng: 139.7234 },
                        { name: 'å›½ç«‹ç«¶æŠ€å ´', lat: 35.6797, lng: 139.7144 },
                        { name: 'ä»£ã€…æœ¨', lat: 35.6839, lng: 139.7019 },
                        { name: 'æ–°å®¿', lat: 35.6896, lng: 139.6994 },
                        { name: 'éƒ½åºå‰', lat: 35.6911, lng: 139.6919 },
                        { name: 'è¥¿æ–°å®¿äº”ä¸ç›®', lat: 35.6956, lng: 139.6844 },
                        { name: 'ä¸­é‡å‚ä¸Š', lat: 35.6975, lng: 139.6758 },
                        { name: 'æ±ä¸­é‡', lat: 35.7069, lng: 139.6794 },
                        { name: 'ä¸­äº•', lat: 35.7150, lng: 139.6847 },
                        { name: 'è½åˆå—é•·å´', lat: 35.7258, lng: 139.6856 },
                        { name: 'æ–°æ±Ÿå¤ç”°', lat: 35.7344, lng: 139.6747 },
                        { name: 'ç·´é¦¬', lat: 35.7378, lng: 139.6536 },
                        { name: 'è±Šå³¶åœ’', lat: 35.7428, lng: 139.6378 },
                        { name: 'ç·´é¦¬æ˜¥æ—¥ç”º', lat: 35.7458, lng: 139.6236 },
                        { name: 'å…‰ãŒä¸˜', lat: 35.7589, lng: 139.6231 },
                    ]
                }
            },

            // JRæ±æ—¥æœ¬
            jr: {
                yamanote: {
                    name: 'å±±æ‰‹ç·š',
                    color: '#9ACD32',
                    avgTime: 2.5,
                    isLoop: true,
                    stations: [
                        { name: 'æ±äº¬', lat: 35.6819, lng: 139.7649 },
                        { name: 'ç¥ç”°', lat: 35.6917, lng: 139.7703 },
                        { name: 'ç§‹è‘‰åŸ', lat: 35.6984, lng: 139.7731 },
                        { name: 'å¾¡å¾’ç”º', lat: 35.7044, lng: 139.7736 },
                        { name: 'ä¸Šé‡', lat: 35.7141, lng: 139.7773 },
                        { name: 'é¶¯è°·', lat: 35.7208, lng: 139.7781 },
                        { name: 'æ—¥æš®é‡Œ', lat: 35.7281, lng: 139.7706 },
                        { name: 'è¥¿æ—¥æš®é‡Œ', lat: 35.7319, lng: 139.7672 },
                        { name: 'ç”°ç«¯', lat: 35.7378, lng: 139.7608 },
                        { name: 'é§’è¾¼', lat: 35.7361, lng: 139.7478 },
                        { name: 'å·£é´¨', lat: 35.7339, lng: 139.7394 },
                        { name: 'å¤§å¡š', lat: 35.7317, lng: 139.7281 },
                        { name: 'æ± è¢‹', lat: 35.7283, lng: 139.7102 },
                        { name: 'ç›®ç™½', lat: 35.7214, lng: 139.7061 },
                        { name: 'é«˜ç”°é¦¬å ´', lat: 35.7127, lng: 139.7036 },
                        { name: 'æ–°å¤§ä¹…ä¿', lat: 35.7011, lng: 139.7000 },
                        { name: 'æ–°å®¿', lat: 35.6896, lng: 139.6994 },
                        { name: 'ä»£ã€…æœ¨', lat: 35.6839, lng: 139.7019 },
                        { name: 'åŸå®¿', lat: 35.6703, lng: 139.7031 },
                        { name: 'æ¸‹è°·', lat: 35.6590, lng: 139.7020 },
                        { name: 'æµæ¯”å¯¿', lat: 35.6467, lng: 139.7108 },
                        { name: 'ç›®é»’', lat: 35.6336, lng: 139.7158 },
                        { name: 'äº”åç”°', lat: 35.6258, lng: 139.7236 },
                        { name: 'å¤§å´', lat: 35.6197, lng: 139.7286 },
                        { name: 'å“å·', lat: 35.6308, lng: 139.7392 },
                        { name: 'é«˜è¼ªã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤', lat: 35.6353, lng: 139.7406 },
                        { name: 'ç”°ç”º', lat: 35.6456, lng: 139.7475 },
                        { name: 'æµœæ¾ç”º', lat: 35.6553, lng: 139.7572 },
                        { name: 'æ–°æ©‹', lat: 35.6658, lng: 139.7594 },
                        { name: 'æœ‰æ¥½ç”º', lat: 35.6750, lng: 139.7600 },
                        { name: 'æ±äº¬', lat: 35.6819, lng: 139.7649 },
                    ]
                },
                chuoRapid: {
                    name: 'ä¸­å¤®ç·šå¿«é€Ÿ',
                    color: '#FF4500',
                    avgTime: 3,
                    stations: [
                        { name: 'æ±äº¬', lat: 35.6819, lng: 139.7649 },
                        { name: 'ç¥ç”°', lat: 35.6917, lng: 139.7703 },
                        { name: 'å¾¡èŒ¶ãƒæ°´', lat: 35.6998, lng: 139.7651 },
                        { name: 'å››ãƒ„è°·', lat: 35.6860, lng: 139.7300 },
                        { name: 'æ–°å®¿', lat: 35.6896, lng: 139.6994 },
                        { name: 'ä¸­é‡', lat: 35.7065, lng: 139.6658 },
                        { name: 'é«˜å††å¯º', lat: 35.7053, lng: 139.6497 },
                        { name: 'é˜¿ä½ãƒ¶è°·', lat: 35.7042, lng: 139.6353 },
                        { name: 'è»çªª', lat: 35.7034, lng: 139.6196 },
                        { name: 'è¥¿è»çªª', lat: 35.7031, lng: 139.5994 },
                        { name: 'å‰ç¥¥å¯º', lat: 35.7033, lng: 139.5794 },
                        { name: 'ä¸‰é·¹', lat: 35.7028, lng: 139.5606 },
                        { name: 'æ­¦è”µå¢ƒ', lat: 35.7017, lng: 139.5436 },
                        { name: 'æ±å°é‡‘äº•', lat: 35.7011, lng: 139.5264 },
                        { name: 'æ­¦è”µå°é‡‘äº•', lat: 35.7006, lng: 139.5067 },
                        { name: 'å›½åˆ†å¯º', lat: 35.7006, lng: 139.4808 },
                        { name: 'è¥¿å›½åˆ†å¯º', lat: 35.6994, lng: 139.4636 },
                        { name: 'å›½ç«‹', lat: 35.6994, lng: 139.4439 },
                        { name: 'ç«‹å·', lat: 35.6972, lng: 139.4142 },
                    ]
                },
                keihinTohoku: {
                    name: 'äº¬æµœæ±åŒ—ç·š',
                    color: '#00BFFF',
                    avgTime: 2.5,
                    stations: [
                        { name: 'å¤§å®®', lat: 35.9064, lng: 139.6231 },
                        { name: 'ã•ã„ãŸã¾æ–°éƒ½å¿ƒ', lat: 35.8939, lng: 139.6319 },
                        { name: 'ä¸é‡', lat: 35.8789, lng: 139.6311 },
                        { name: 'åŒ—æµ¦å’Œ', lat: 35.8656, lng: 139.6311 },
                        { name: 'æµ¦å’Œ', lat: 35.8583, lng: 139.6567 },
                        { name: 'å—æµ¦å’Œ', lat: 35.8472, lng: 139.6697 },
                        { name: 'è•¨', lat: 35.8264, lng: 139.6833 },
                        { name: 'è¥¿å·å£', lat: 35.8100, lng: 139.7067 },
                        { name: 'å·å£', lat: 35.8017, lng: 139.7203 },
                        { name: 'èµ¤ç¾½', lat: 35.7778, lng: 139.7208 },
                        { name: 'æ±åæ¡', lat: 35.7625, lng: 139.7239 },
                        { name: 'ç‹å­', lat: 35.7536, lng: 139.7381 },
                        { name: 'ä¸Šä¸­é‡Œ', lat: 35.7475, lng: 139.7475 },
                        { name: 'ç”°ç«¯', lat: 35.7378, lng: 139.7608 },
                        { name: 'è¥¿æ—¥æš®é‡Œ', lat: 35.7319, lng: 139.7672 },
                        { name: 'æ—¥æš®é‡Œ', lat: 35.7281, lng: 139.7706 },
                        { name: 'é¶¯è°·', lat: 35.7208, lng: 139.7781 },
                        { name: 'ä¸Šé‡', lat: 35.7141, lng: 139.7773 },
                        { name: 'å¾¡å¾’ç”º', lat: 35.7044, lng: 139.7736 },
                        { name: 'ç§‹è‘‰åŸ', lat: 35.6984, lng: 139.7731 },
                        { name: 'ç¥ç”°', lat: 35.6917, lng: 139.7703 },
                        { name: 'æ±äº¬', lat: 35.6819, lng: 139.7649 },
                        { name: 'æœ‰æ¥½ç”º', lat: 35.6750, lng: 139.7600 },
                        { name: 'æ–°æ©‹', lat: 35.6658, lng: 139.7594 },
                        { name: 'æµœæ¾ç”º', lat: 35.6553, lng: 139.7572 },
                        { name: 'ç”°ç”º', lat: 35.6456, lng: 139.7475 },
                        { name: 'é«˜è¼ªã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤', lat: 35.6353, lng: 139.7406 },
                        { name: 'å“å·', lat: 35.6308, lng: 139.7392 },
                        { name: 'å¤§äº•ç”º', lat: 35.6072, lng: 139.7347 },
                        { name: 'å¤§æ£®', lat: 35.5883, lng: 139.7286 },
                        { name: 'è’²ç”°', lat: 35.5625, lng: 139.7158 },
                    ]
                },
                sobu: {
                    name: 'ç·æ­¦ç·šå„åœ',
                    color: '#FFD700',
                    avgTime: 2,
                    stations: [
                        { name: 'ä¸‰é·¹', lat: 35.7028, lng: 139.5606 },
                        { name: 'å‰ç¥¥å¯º', lat: 35.7033, lng: 139.5794 },
                        { name: 'è¥¿è»çªª', lat: 35.7031, lng: 139.5994 },
                        { name: 'è»çªª', lat: 35.7034, lng: 139.6196 },
                        { name: 'é˜¿ä½ãƒ¶è°·', lat: 35.7042, lng: 139.6353 },
                        { name: 'é«˜å††å¯º', lat: 35.7053, lng: 139.6497 },
                        { name: 'ä¸­é‡', lat: 35.7065, lng: 139.6658 },
                        { name: 'æ±ä¸­é‡', lat: 35.7069, lng: 139.6794 },
                        { name: 'å¤§ä¹…ä¿', lat: 35.7011, lng: 139.6908 },
                        { name: 'æ–°å®¿', lat: 35.6896, lng: 139.6994 },
                        { name: 'ä»£ã€…æœ¨', lat: 35.6839, lng: 139.7019 },
                        { name: 'åƒé§„ãƒ¶è°·', lat: 35.6797, lng: 139.7144 },
                        { name: 'ä¿¡æ¿ƒç”º', lat: 35.6803, lng: 139.7203 },
                        { name: 'å››ãƒ„è°·', lat: 35.6860, lng: 139.7300 },
                        { name: 'å¸‚ã‚±è°·', lat: 35.6914, lng: 139.7436 },
                        { name: 'é£¯ç”°æ©‹', lat: 35.7014, lng: 139.7452 },
                        { name: 'æ°´é“æ©‹', lat: 35.7019, lng: 139.7536 },
                        { name: 'å¾¡èŒ¶ãƒæ°´', lat: 35.6998, lng: 139.7651 },
                        { name: 'ç§‹è‘‰åŸ', lat: 35.6984, lng: 139.7731 },
                        { name: 'æµ…è‰æ©‹', lat: 35.6972, lng: 139.7883 },
                        { name: 'ä¸¡å›½', lat: 35.6964, lng: 139.7936 },
                        { name: 'éŒ¦ç³¸ç”º', lat: 35.6964, lng: 139.8142 },
                        { name: 'äº€æˆ¸', lat: 35.6972, lng: 139.8267 },
                        { name: 'å¹³äº•', lat: 35.7072, lng: 139.8439 },
                        { name: 'æ–°å°å²©', lat: 35.7167, lng: 139.8581 },
                    ]
                },
                saikyo: {
                    name: 'åŸ¼äº¬ç·š',
                    color: '#00AC9B',
                    avgTime: 2.5,
                    stations: [
                        { name: 'å¤§å´', lat: 35.6197, lng: 139.7286 },
                        { name: 'æµæ¯”å¯¿', lat: 35.6467, lng: 139.7108 },
                        { name: 'æ¸‹è°·', lat: 35.6590, lng: 139.7020 },
                        { name: 'æ–°å®¿', lat: 35.6896, lng: 139.6994 },
                        { name: 'æ± è¢‹', lat: 35.7283, lng: 139.7102 },
                        { name: 'æ¿æ©‹', lat: 35.7514, lng: 139.7203 },
                        { name: 'åæ¡', lat: 35.7639, lng: 139.7219 },
                        { name: 'èµ¤ç¾½', lat: 35.7778, lng: 139.7208 },
                        { name: 'åŒ—èµ¤ç¾½', lat: 35.7867, lng: 139.7089 },
                        { name: 'æµ®é–“èˆŸæ¸¡', lat: 35.7939, lng: 139.6978 },
                        { name: 'æˆ¸ç”°å…¬åœ’', lat: 35.8047, lng: 139.6803 },
                        { name: 'æˆ¸ç”°', lat: 35.8119, lng: 139.6719 },
                        { name: 'åŒ—æˆ¸ç”°', lat: 35.8200, lng: 139.6644 },
                        { name: 'æ­¦è”µæµ¦å’Œ', lat: 35.8344, lng: 139.6486 },
                        { name: 'ä¸­æµ¦å’Œ', lat: 35.8447, lng: 139.6353 },
                        { name: 'å—ä¸é‡', lat: 35.8550, lng: 139.6275 },
                        { name: 'ä¸é‡æœ¬ç”º', lat: 35.8656, lng: 139.6247 },
                        { name: 'åŒ—ä¸é‡', lat: 35.8831, lng: 139.6275 },
                        { name: 'å¤§å®®', lat: 35.9064, lng: 139.6231 },
                    ]
                }
            },

            // ç§é‰„
            private: {
                tokyu_toyoko: {
                    name: 'æ±æ€¥æ±æ¨ªç·š',
                    color: '#EE3C3C',
                    avgTime: 2,
                    stations: [
                        { name: 'æ¸‹è°·', lat: 35.6590, lng: 139.7020 },
                        { name: 'ä»£å®˜å±±', lat: 35.6489, lng: 139.7031 },
                        { name: 'ä¸­ç›®é»’', lat: 35.6440, lng: 139.6988 },
                        { name: 'ç¥å¤©å¯º', lat: 35.6364, lng: 139.6897 },
                        { name: 'å­¦èŠ¸å¤§å­¦', lat: 35.6283, lng: 139.6853 },
                        { name: 'éƒ½ç«‹å¤§å­¦', lat: 35.6175, lng: 139.6789 },
                        { name: 'è‡ªç”±ãŒä¸˜', lat: 35.6072, lng: 139.6703 },
                        { name: 'ç”°åœ’èª¿å¸ƒ', lat: 35.5992, lng: 139.6681 },
                        { name: 'å¤šæ‘©å·', lat: 35.5894, lng: 139.6683 },
                        { name: 'æ–°ä¸¸å­', lat: 35.5808, lng: 139.6614 },
                        { name: 'æ­¦è”µå°æ‰', lat: 35.5769, lng: 139.6583 },
                        { name: 'å…ƒä½å‰', lat: 35.5672, lng: 139.6536 },
                        { name: 'æ—¥å‰', lat: 35.5536, lng: 139.6472 },
                        { name: 'ç¶±å³¶', lat: 35.5378, lng: 139.6350 },
                        { name: 'å¤§å€‰å±±', lat: 35.5244, lng: 139.6264 },
                        { name: 'èŠå', lat: 35.5100, lng: 139.6183 },
                        { name: 'å¦™è“®å¯º', lat: 35.4961, lng: 139.6161 },
                        { name: 'ç™½æ¥½', lat: 35.4883, lng: 139.6169 },
                        { name: 'æ±ç™½æ¥½', lat: 35.4833, lng: 139.6233 },
                        { name: 'åç”º', lat: 35.4761, lng: 139.6286 },
                        { name: 'æ¨ªæµœ', lat: 35.4667, lng: 139.6231 },
                    ]
                },
                odakyu: {
                    name: 'å°ç”°æ€¥ç·š',
                    color: '#1E90FF',
                    avgTime: 2.5,
                    stations: [
                        { name: 'æ–°å®¿', lat: 35.6896, lng: 139.6994 },
                        { name: 'å—æ–°å®¿', lat: 35.6869, lng: 139.6972 },
                        { name: 'å‚å®®æ©‹', lat: 35.6825, lng: 139.6908 },
                        { name: 'ä»£ã€…æœ¨å…«å¹¡', lat: 35.6694, lng: 139.6864 },
                        { name: 'ä»£ã€…æœ¨ä¸ŠåŸ', lat: 35.6683, lng: 139.6778 },
                        { name: 'æ±åŒ—æ²¢', lat: 35.6636, lng: 139.6722 },
                        { name: 'ä¸‹åŒ—æ²¢', lat: 35.6611, lng: 139.6669 },
                        { name: 'ä¸–ç”°è°·ä»£ç”°', lat: 35.6575, lng: 139.6606 },
                        { name: 'æ¢…ãƒ¶ä¸˜', lat: 35.6536, lng: 139.6508 },
                        { name: 'è±ªå¾³å¯º', lat: 35.6492, lng: 139.6444 },
                        { name: 'çµŒå ‚', lat: 35.6456, lng: 139.6353 },
                        { name: 'åƒæ­³èˆ¹æ©‹', lat: 35.6411, lng: 139.6231 },
                        { name: 'ç¥–å¸«ãƒ¶è°·å¤§è”µ', lat: 35.6372, lng: 139.6125 },
                        { name: 'æˆåŸå­¦åœ’å‰', lat: 35.6347, lng: 139.6011 },
                        { name: 'å–œå¤šè¦‹', lat: 35.6331, lng: 139.5897 },
                        { name: 'ç‹›æ±Ÿ', lat: 35.6317, lng: 139.5775 },
                        { name: 'å’Œæ³‰å¤šæ‘©å·', lat: 35.6308, lng: 139.5658 },
                        { name: 'ç™»æˆ¸', lat: 35.6286, lng: 139.5642 },
                    ]
                },
                keio: {
                    name: 'äº¬ç‹ç·š',
                    color: '#DD0077',
                    avgTime: 2,
                    stations: [
                        { name: 'æ–°å®¿', lat: 35.6896, lng: 139.6994 },
                        { name: 'ç¬¹å¡š', lat: 35.6742, lng: 139.6669 },
                        { name: 'ä»£ç”°æ©‹', lat: 35.6675, lng: 139.6583 },
                        { name: 'æ˜å¤§å‰', lat: 35.6664, lng: 139.6483 },
                        { name: 'ä¸‹é«˜äº•æˆ¸', lat: 35.6656, lng: 139.6381 },
                        { name: 'æ¡œä¸Šæ°´', lat: 35.6672, lng: 139.6256 },
                        { name: 'ä¸ŠåŒ—æ²¢', lat: 35.6694, lng: 139.6139 },
                        { name: 'å…«å¹¡å±±', lat: 35.6694, lng: 139.6056 },
                        { name: 'èŠ¦èŠ±å…¬åœ’', lat: 35.6692, lng: 139.5986 },
                        { name: 'åƒæ­³çƒå±±', lat: 35.6700, lng: 139.5892 },
                        { name: 'ä»™å·', lat: 35.6700, lng: 139.5731 },
                        { name: 'ã¤ã¤ã˜ãƒ¶ä¸˜', lat: 35.6644, lng: 139.5594 },
                        { name: 'æŸ´å´', lat: 35.6597, lng: 139.5492 },
                        { name: 'å›½é ˜', lat: 35.6564, lng: 139.5408 },
                        { name: 'å¸ƒç”°', lat: 35.6531, lng: 139.5358 },
                        { name: 'èª¿å¸ƒ', lat: 35.6517, lng: 139.5433 },
                    ]
                },
                seibu_ikebukuro: {
                    name: 'è¥¿æ­¦æ± è¢‹ç·š',
                    color: '#0068B7',
                    avgTime: 2.5,
                    stations: [
                        { name: 'æ± è¢‹', lat: 35.7283, lng: 139.7102 },
                        { name: 'æ¤åç”º', lat: 35.7272, lng: 139.6953 },
                        { name: 'æ±é•·å´', lat: 35.7294, lng: 139.6858 },
                        { name: 'æ±Ÿå¤ç”°', lat: 35.7350, lng: 139.6772 },
                        { name: 'æ¡œå°', lat: 35.7378, lng: 139.6675 },
                        { name: 'ç·´é¦¬', lat: 35.7378, lng: 139.6536 },
                        { name: 'ä¸­æ‘æ©‹', lat: 35.7358, lng: 139.6369 },
                        { name: 'å¯Œå£«è¦‹å°', lat: 35.7331, lng: 139.6264 },
                        { name: 'ç·´é¦¬é«˜é‡å°', lat: 35.7314, lng: 139.6144 },
                        { name: 'çŸ³ç¥äº•å…¬åœ’', lat: 35.7381, lng: 139.5997 },
                        { name: 'å¤§æ³‰å­¦åœ’', lat: 35.7478, lng: 139.5803 },
                        { name: 'ä¿è°·', lat: 35.7550, lng: 139.5611 },
                        { name: 'ã²ã°ã‚Šãƒ¶ä¸˜', lat: 35.7550, lng: 139.5397 },
                        { name: 'æ±ä¹…ç•™ç±³', lat: 35.7544, lng: 139.5197 },
                        { name: 'æ¸…ç€¬', lat: 35.7583, lng: 139.5053 },
                        { name: 'ç§‹æ´¥', lat: 35.7647, lng: 139.4931 },
                        { name: 'æ‰€æ²¢', lat: 35.7861, lng: 139.4681 },
                    ]
                },
                tobu_tojo: {
                    name: 'æ±æ­¦æ±ä¸Šç·š',
                    color: '#0068B7',
                    avgTime: 2.5,
                    stations: [
                        { name: 'æ± è¢‹', lat: 35.7283, lng: 139.7102 },
                        { name: 'åŒ—æ± è¢‹', lat: 35.7347, lng: 139.7103 },
                        { name: 'ä¸‹æ¿æ©‹', lat: 35.7414, lng: 139.7097 },
                        { name: 'å¤§å±±', lat: 35.7475, lng: 139.7019 },
                        { name: 'ä¸­æ¿æ©‹', lat: 35.7550, lng: 139.6969 },
                        { name: 'ã¨ãã‚å°', lat: 35.7622, lng: 139.6892 },
                        { name: 'ä¸Šæ¿æ©‹', lat: 35.7683, lng: 139.6817 },
                        { name: 'æ±æ­¦ç·´é¦¬', lat: 35.7753, lng: 139.6742 },
                        { name: 'ä¸‹èµ¤å¡š', lat: 35.7808, lng: 139.6617 },
                        { name: 'æˆå¢—', lat: 35.7814, lng: 139.6400 },
                        { name: 'å’Œå…‰å¸‚', lat: 35.7878, lng: 139.6214 },
                        { name: 'æœéœ', lat: 35.7961, lng: 139.5981 },
                        { name: 'æœéœå°', lat: 35.8008, lng: 139.5831 },
                        { name: 'å¿—æœ¨', lat: 35.8061, lng: 139.5672 },
                    ]
                },
                keikyu: {
                    name: 'äº¬æ€¥ç·š',
                    color: '#EE1133',
                    avgTime: 2,
                    stations: [
                        { name: 'æ³‰å²³å¯º', lat: 35.6403, lng: 139.7408 },
                        { name: 'å“å·', lat: 35.6308, lng: 139.7392 },
                        { name: 'åŒ—å“å·', lat: 35.6228, lng: 139.7406 },
                        { name: 'æ–°é¦¬å ´', lat: 35.6153, lng: 139.7419 },
                        { name: 'é’ç‰©æ¨ªä¸', lat: 35.6081, lng: 139.7433 },
                        { name: 'é®«æ´²', lat: 35.6008, lng: 139.7433 },
                        { name: 'ç«‹ä¼šå·', lat: 35.5942, lng: 139.7414 },
                        { name: 'å¤§æ£®æµ·å²¸', lat: 35.5867, lng: 139.7356 },
                        { name: 'å¹³å’Œå³¶', lat: 35.5792, lng: 139.7364 },
                        { name: 'å¤§æ£®ç”º', lat: 35.5711, lng: 139.7289 },
                        { name: 'æ¢…å±‹æ•·', lat: 35.5631, lng: 139.7244 },
                        { name: 'äº¬æ€¥è’²ç”°', lat: 35.5575, lng: 139.7214 },
                        { name: 'é›‘è‰²', lat: 35.5453, lng: 139.7103 },
                        { name: 'å…­éƒ·åœŸæ‰‹', lat: 35.5339, lng: 139.7014 },
                        { name: 'äº¬æ€¥å·å´', lat: 35.5311, lng: 139.6986 },
                    ]
                },
                tx: {
                    name: 'ã¤ãã°ã‚¨ã‚¯ã‚¹ãƒ—ãƒ¬ã‚¹',
                    color: '#2E8B57',
                    avgTime: 3,
                    stations: [
                        { name: 'ç§‹è‘‰åŸ', lat: 35.6984, lng: 139.7731 },
                        { name: 'æ–°å¾¡å¾’ç”º', lat: 35.7042, lng: 139.7822 },
                        { name: 'æµ…è‰', lat: 35.7112, lng: 139.7964 },
                        { name: 'å—åƒä½', lat: 35.7324, lng: 139.8007 },
                        { name: 'åŒ—åƒä½', lat: 35.7497, lng: 139.8047 },
                        { name: 'é’äº•', lat: 35.7647, lng: 139.8275 },
                        { name: 'å…­ç”º', lat: 35.7731, lng: 139.8378 },
                        { name: 'å…«æ½®', lat: 35.8194, lng: 139.8389 },
                        { name: 'ä¸‰éƒ·ä¸­å¤®', lat: 35.8386, lng: 139.8672 },
                        { name: 'å—æµå±±', lat: 35.8497, lng: 139.8986 },
                        { name: 'æµå±±ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒ‘ãƒ¼ã‚¯', lat: 35.8625, lng: 139.9158 },
                        { name: 'æµå±±ãŠãŠãŸã‹ã®æ£®', lat: 35.8722, lng: 139.9281 },
                    ]
                }
            },

            // æ–°å¹¹ç·š
            shinkansen: {
                tokaido: {
                    name: 'æ±æµ·é“æ–°å¹¹ç·š',
                    color: '#0066CC',
                    avgTime: 15,
                    stations: [
                        { name: 'æ±äº¬', lat: 35.6819, lng: 139.7649 },
                        { name: 'å“å·', lat: 35.6308, lng: 139.7392 },
                        { name: 'æ–°æ¨ªæµœ', lat: 35.5067, lng: 139.6181 },
                        { name: 'å°ç”°åŸ', lat: 35.2564, lng: 139.1553 },
                        { name: 'ç†±æµ·', lat: 35.1042, lng: 139.0775 },
                        { name: 'ä¸‰å³¶', lat: 35.1269, lng: 138.9106 },
                        { name: 'æ–°å¯Œå£«', lat: 35.1417, lng: 138.6703 },
                        { name: 'é™å²¡', lat: 34.9719, lng: 138.3889 },
                        { name: 'æ›å·', lat: 34.7683, lng: 137.9986 },
                        { name: 'æµœæ¾', lat: 34.7036, lng: 137.7344 },
                        { name: 'è±Šæ©‹', lat: 34.7631, lng: 137.3819 },
                        { name: 'ä¸‰æ²³å®‰åŸ', lat: 34.9589, lng: 137.0611 },
                        { name: 'åå¤å±‹', lat: 35.1706, lng: 136.8819 },
                        { name: 'å²é˜œç¾½å³¶', lat: 35.3164, lng: 136.6869 },
                        { name: 'ç±³åŸ', lat: 35.3147, lng: 136.2900 },
                        { name: 'äº¬éƒ½', lat: 34.9858, lng: 135.7589 },
                        { name: 'æ–°å¤§é˜ª', lat: 34.7336, lng: 135.5003 },
                    ]
                },
                tohoku: {
                    name: 'æ±åŒ—æ–°å¹¹ç·š',
                    color: '#00994C',
                    avgTime: 20,
                    stations: [
                        { name: 'æ±äº¬', lat: 35.6819, lng: 139.7649 },
                        { name: 'ä¸Šé‡', lat: 35.7141, lng: 139.7773 },
                        { name: 'å¤§å®®', lat: 35.9064, lng: 139.6231 },
                        { name: 'å°å±±', lat: 36.3147, lng: 139.8011 },
                        { name: 'å®‡éƒ½å®®', lat: 36.5589, lng: 139.8983 },
                        { name: 'é‚£é ˆå¡©åŸ', lat: 36.9614, lng: 140.0467 },
                        { name: 'æ–°ç™½æ²³', lat: 37.1250, lng: 140.2122 },
                        { name: 'éƒ¡å±±', lat: 37.3981, lng: 140.3883 },
                        { name: 'ç¦å³¶', lat: 37.7544, lng: 140.4600 },
                        { name: 'ç™½çŸ³è”µç‹', lat: 38.0017, lng: 140.6203 },
                        { name: 'ä»™å°', lat: 38.2603, lng: 140.8822 },
                        { name: 'å¤å·', lat: 38.6047, lng: 140.9733 },
                        { name: 'ä¸€ãƒé–¢', lat: 38.9344, lng: 141.1264 },
                        { name: 'æ°´æ²¢æ±Ÿåˆº', lat: 39.1156, lng: 141.1403 },
                        { name: 'åŒ—ä¸Š', lat: 39.2856, lng: 141.1125 },
                        { name: 'æ–°èŠ±å·»', lat: 39.3839, lng: 141.1094 },
                        { name: 'ç››å²¡', lat: 39.7017, lng: 141.1361 },
                    ]
                },
                joetsu: {
                    name: 'ä¸Šè¶Šæ–°å¹¹ç·š',
                    color: '#E6007E',
                    avgTime: 15,
                    stations: [
                        { name: 'æ±äº¬', lat: 35.6819, lng: 139.7649 },
                        { name: 'ä¸Šé‡', lat: 35.7141, lng: 139.7773 },
                        { name: 'å¤§å®®', lat: 35.9064, lng: 139.6231 },
                        { name: 'ç†Šè°·', lat: 36.1478, lng: 139.3889 },
                        { name: 'æœ¬åº„æ—©ç¨²ç”°', lat: 36.2397, lng: 139.1689 },
                        { name: 'é«˜å´', lat: 36.3222, lng: 139.0106 },
                        { name: 'ä¸Šæ¯›é«˜åŸ', lat: 36.6381, lng: 138.9536 },
                        { name: 'è¶Šå¾Œæ¹¯æ²¢', lat: 36.9314, lng: 138.8150 },
                        { name: 'æµ¦ä½', lat: 37.0783, lng: 138.9600 },
                        { name: 'é•·å²¡', lat: 37.4464, lng: 138.8500 },
                        { name: 'ç‡•ä¸‰æ¡', lat: 37.6317, lng: 138.9336 },
                        { name: 'æ–°æ½Ÿ', lat: 37.9125, lng: 139.0619 },
                    ]
                }
            }
        };

        // èˆªç©ºè·¯ç·šã¨ç©ºæ¸¯
        const airports = {
            haneda: { name: 'ç¾½ç”°ç©ºæ¸¯', lat: 35.5494, lng: 139.7798 },
            narita: { name: 'æˆç”°ç©ºæ¸¯', lat: 35.7720, lng: 140.3929 },
            chitose: { name: 'æ–°åƒæ­³ç©ºæ¸¯', lat: 42.7752, lng: 141.6924 },
            itami: { name: 'ä¼Šä¸¹ç©ºæ¸¯', lat: 34.7854, lng: 135.4383 },
            kansai: { name: 'é–¢è¥¿ç©ºæ¸¯', lat: 34.4320, lng: 135.2304 },
            fukuoka: { name: 'ç¦å²¡ç©ºæ¸¯', lat: 33.5850, lng: 130.4514 },
            naha: { name: 'é‚£è¦‡ç©ºæ¸¯', lat: 26.1958, lng: 127.6459 },
            chubu: { name: 'ä¸­éƒ¨ç©ºæ¸¯', lat: 34.8583, lng: 136.8054 },
        };

        const airRoutes = [
            { from: 'haneda', to: 'chitose', flightTime: 90 },
            { from: 'haneda', to: 'itami', flightTime: 65 },
            { from: 'haneda', to: 'fukuoka', flightTime: 100 },
            { from: 'haneda', to: 'naha', flightTime: 150 },
            { from: 'narita', to: 'chitose', flightTime: 95 },
            { from: 'narita', to: 'fukuoka', flightTime: 110 },
            { from: 'haneda', to: 'kansai', flightTime: 70 },
            { from: 'haneda', to: 'chubu', flightTime: 60 },
        ];

        // ========================================
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        // ========================================
        
        // 2ç‚¹é–“ã®è·é›¢ï¼ˆkmï¼‰
        function getDistance(lat1, lng1, lat2, lng2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        // è·¯ç·šã®ç·è·é›¢ï¼ˆkmï¼‰
        function getRouteDistance(stations) {
            let total = 0;
            for (let i = 0; i < stations.length - 1; i++) {
                total += getDistance(
                    stations[i].lat, stations[i].lng,
                    stations[i+1].lat, stations[i+1].lng
                );
            }
            return total;
        }

        // ========================================
        // è·¯ç·šãƒªã‚¹ãƒˆç”Ÿæˆ
        // ========================================
        function generateLineList() {
            const container = document.getElementById('lineList');
            let html = '';
            
            const categories = [
                { key: 'metro', data: railwayData.metro, label: 'ğŸš‡ æ±äº¬ãƒ¡ãƒˆãƒ­' },
                { key: 'toei', data: railwayData.toei, label: 'ğŸšˆ éƒ½å–¶åœ°ä¸‹é‰„' },
                { key: 'jr', data: railwayData.jr, label: 'ğŸšƒ JRæ±æ—¥æœ¬' },
                { key: 'private', data: railwayData.private, label: 'ğŸš‹ ç§é‰„' },
                { key: 'shinkansen', data: railwayData.shinkansen, label: 'ğŸš… æ–°å¹¹ç·š' },
            ];

            categories.forEach(cat => {
                html += `<div class="font-bold text-gray-700 mt-2 mb-1 text-xs">${cat.label}</div>`;
                for (const [key, line] of Object.entries(cat.data)) {
                    const lineId = `${cat.key}_${key}`;
                    lineVisibility[lineId] = true;
                    html += createLineItem(lineId, line.name, line.color);
                }
            });
            
            // é£›è¡Œæ©Ÿ
            lineVisibility['airplane'] = true;
            html += '<div class="font-bold text-gray-700 mt-2 mb-1 text-xs">âœˆï¸ èˆªç©ºè·¯ç·š</div>';
            html += createLineItem('airplane', 'å›½å†…ç·š', '#FF8C00');
            
            container.innerHTML = html;
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            document.querySelectorAll('.line-toggle').forEach(el => {
                el.addEventListener('change', (e) => {
                    lineVisibility[e.target.dataset.line] = e.target.checked;
                    updateVisibility();
                });
            });
        }

        function createLineItem(id, name, color) {
            return `
                <label class="line-item flex items-center gap-2 p-1 rounded cursor-pointer">
                    <input type="checkbox" class="line-toggle w-3 h-3" data-line="${id}" checked>
                    <div class="w-3 h-3 rounded-full" style="background:${color}"></div>
                    <span class="text-gray-600 text-xs">${name}</span>
                </label>
            `;
        }

        // ========================================
        // è·¯ç·šæç”»
        // ========================================
        function drawRoutes() {
            const categories = ['metro', 'toei', 'jr', 'private', 'shinkansen'];
            
            categories.forEach(cat => {
                for (const [key, line] of Object.entries(railwayData[cat])) {
                    const coords = line.stations.map(s => [s.lat, s.lng]);
                    const weight = cat === 'shinkansen' ? 4 : 3;
                    const polyline = L.polyline(coords, {
                        color: line.color,
                        weight: weight,
                        opacity: 0.7
                    }).addTo(map);
                    routeLines[`${cat}_${key}`] = polyline;
                }
            });
            
            // èˆªç©ºè·¯ç·šï¼ˆç‚¹ç·šï¼‰
            const airPolylines = [];
            airRoutes.forEach(route => {
                const from = airports[route.from];
                const to = airports[route.to];
                const polyline = L.polyline([[from.lat, from.lng], [to.lat, to.lng]], {
                    color: '#FF8C00',
                    weight: 2,
                    opacity: 0.3,
                    dashArray: '10, 10'
                }).addTo(map);
                airPolylines.push(polyline);
            });
            routeLines['airplane'] = airPolylines;
        }

        // ========================================
        // è»Šä¸¡ç”Ÿæˆï¼ˆç¾å®Ÿçš„ãªé€Ÿåº¦è¨ˆç®—ï¼‰
        // ========================================
        function generateVehicles() {
            vehicles = [];
            const categories = ['metro', 'toei', 'jr', 'private', 'shinkansen'];
            const emojis = { metro: 'ğŸš‡', toei: 'ğŸšˆ', jr: 'ğŸšƒ', private: 'ğŸš‹', shinkansen: 'ğŸš…' };
            
            categories.forEach(cat => {
                for (const [key, line] of Object.entries(railwayData[cat])) {
                    const lineId = `${cat}_${key}`;
                    const routeDistance = getRouteDistance(line.stations);
                    const speed = CONFIG.speeds[cat]; // km/h
                    
                    // 1å¾€å¾©ã«ã‹ã‹ã‚‹æ™‚é–“ï¼ˆåˆ†ï¼‰
                    const tripTimeMinutes = (routeDistance / speed) * 60 * 2;
                    
                    // è·¯ç·šã«é…ç½®ã™ã‚‹è»Šä¸¡æ•°ï¼ˆç´„5åˆ†é–“éš”ï¼‰
                    const numTrains = Math.max(4, Math.floor(tripTimeMinutes / 5));
                    
                    for (let i = 0; i < numTrains; i++) {
                        const progress = i / numTrains;
                        const direction = (i % 2 === 0) ? 1 : -1;
                        
                        vehicles.push({
                            id: `${lineId}_${i}`,
                            lineId: lineId,
                            type: cat,
                            name: `${line.name} ${Math.floor(Math.random() * 900) + 100}`,
                            line: line,
                            progress: progress,
                            direction: direction,
                            emoji: emojis[cat],
                            color: line.color,
                            routeDistance: routeDistance,
                            speed: speed
                        });
                    }
                }
            });
            
            // é£›è¡Œæ©Ÿ
            airRoutes.forEach((route, i) => {
                const from = airports[route.from];
                const to = airports[route.to];
                const distance = getDistance(from.lat, from.lng, to.lat, to.lng);
                
                // å¾€å¾©2ä¾¿ãšã¤
                for (let j = 0; j < 2; j++) {
                    vehicles.push({
                        id: `airplane_${i}_${j}`,
                        lineId: 'airplane',
                        type: 'airplane',
                        name: `${from.name}â†’${to.name} ${['ANA', 'JAL'][j]}${100 + i * 10 + j}`,
                        route: [from, to],
                        progress: Math.random(),
                        direction: 1,
                        emoji: 'âœˆï¸',
                        color: '#FF8C00',
                        routeDistance: distance,
                        speed: CONFIG.speeds.airplane,
                        flightTime: route.flightTime
                    });
                    
                    // é€†æ–¹å‘
                    vehicles.push({
                        id: `airplane_r_${i}_${j}`,
                        lineId: 'airplane',
                        type: 'airplane',
                        name: `${to.name}â†’${from.name} ${['ANA', 'JAL'][j]}${200 + i * 10 + j}`,
                        route: [to, from],
                        progress: Math.random(),
                        direction: 1,
                        emoji: 'âœˆï¸',
                        color: '#FF8C00',
                        routeDistance: distance,
                        speed: CONFIG.speeds.airplane,
                        flightTime: route.flightTime
                    });
                }
            });
        }

        // ========================================
        // ä½ç½®è¨ˆç®—
        // ========================================
        function getPositionOnRoute(vehicle) {
            let stations;
            if (vehicle.type === 'airplane') {
                stations = vehicle.route;
            } else {
                stations = vehicle.line.stations;
            }
            
            const totalSegments = stations.length - 1;
            if (totalSegments <= 0) return [stations[0].lat, stations[0].lng];
            
            const segmentProgress = vehicle.progress * totalSegments;
            const segmentIndex = Math.min(Math.floor(segmentProgress), totalSegments - 1);
            const localProgress = segmentProgress - segmentIndex;
            
            const start = stations[segmentIndex];
            const end = stations[Math.min(segmentIndex + 1, stations.length - 1)];
            
            return [
                start.lat + (end.lat - start.lat) * localProgress,
                start.lng + (end.lng - start.lng) * localProgress
            ];
        }

        // ========================================
        // ãƒãƒ¼ã‚«ãƒ¼ä½œæˆ
        // ========================================
        function createMarkers() {
            vehicles.forEach(vehicle => {
                const position = getPositionOnRoute(vehicle);
                const size = vehicle.type === 'airplane' ? 28 : 
                             vehicle.type === 'shinkansen' ? 24 : 18;
                
                const icon = L.divIcon({
                    html: `<div class="vehicle-icon" style="width:${size}px;height:${size}px;background:${vehicle.color};color:white;font-size:${size * 0.6}px;">${vehicle.emoji}</div>`,
                    className: '',
                    iconSize: [size, size],
                    iconAnchor: [size/2, size/2]
                });
                
                const marker = L.marker(position, { icon: icon }).addTo(map);
                
                const speedKmh = vehicle.speed;
                marker.bindPopup(`
                    <div class="text-center p-2">
                        <div class="text-2xl mb-1">${vehicle.emoji}</div>
                        <div class="font-bold text-gray-800">${vehicle.name}</div>
                        <div class="text-xs text-gray-500 mt-1">
                            é€Ÿåº¦: ç´„${speedKmh}km/h
                        </div>
                        <div class="text-xs text-green-600 mt-1">â— é‹è¡Œä¸­</div>
                    </div>
                `);
                
                markers[vehicle.id] = marker;
            });
        }

        // ========================================
        // è¡¨ç¤ºæ›´æ–°
        // ========================================
        function updateVisibility() {
            let totalVisible = 0;
            let visibleLines = 0;
            
            for (const [id, line] of Object.entries(routeLines)) {
                if (Array.isArray(line)) {
                    line.forEach(l => {
                        if (lineVisibility[id]) l.addTo(map);
                        else map.removeLayer(l);
                    });
                } else {
                    if (lineVisibility[id]) {
                        line.addTo(map);
                        visibleLines++;
                    } else {
                        map.removeLayer(line);
                    }
                }
            }
            
            vehicles.forEach(vehicle => {
                const marker = markers[vehicle.id];
                if (!marker) return;
                
                if (lineVisibility[vehicle.lineId]) {
                    marker.addTo(map);
                    totalVisible++;
                } else {
                    map.removeLayer(marker);
                }
            });
            
            document.getElementById('totalVehicles').textContent = totalVisible;
            document.getElementById('totalLines').textContent = Object.values(lineVisibility).filter(v => v).length;
        }

        // ========================================
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°ï¼ˆç¾å®Ÿçš„ãªé€Ÿåº¦ï¼‰
        // ========================================
        function updatePositions() {
            const now = Date.now();
            const dt = CONFIG.updateInterval / 1000; // ç§’
            const realTimeSeconds = dt * CONFIG.timeScale;
            
            vehicles.forEach(vehicle => {
                const marker = markers[vehicle.id];
                if (!marker || !lineVisibility[vehicle.lineId]) return;
                
                // 1ç§’é–“ã«é€²ã‚€è·é›¢ï¼ˆkmï¼‰
                const distancePerSecond = vehicle.speed / 3600;
                // æ™‚é–“ã‚¹ã‚±ãƒ¼ãƒ«ã‚’é©ç”¨
                const movedDistance = distancePerSecond * realTimeSeconds;
                // é€²æ—ç‡ã«æ›ç®—
                const progressDelta = movedDistance / vehicle.routeDistance;
                
                vehicle.progress += progressDelta * vehicle.direction;
                
                // ç«¯ã«åˆ°é”ã—ãŸã‚‰æŠ˜ã‚Šè¿”ã—ï¼ˆç’°çŠ¶ç·šä»¥å¤–ï¼‰
                if (vehicle.line?.isLoop) {
                    if (vehicle.progress >= 1) vehicle.progress = 0;
                    if (vehicle.progress < 0) vehicle.progress = 1;
                } else {
                    if (vehicle.progress >= 1 || vehicle.progress <= 0) {
                        vehicle.direction *= -1;
                        vehicle.progress = Math.max(0, Math.min(1, vehicle.progress));
                    }
                }
                
                const pos = getPositionOnRoute(vehicle);
                marker.setLatLng(pos);
            });
        }

        // ========================================
        // æ™‚åˆ»æ›´æ–°
        // ========================================
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        }

        // ========================================
        // ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒˆã‚°ãƒ«
        // ========================================
        function setupCategoryToggles() {
            const toggles = {
                'toggleAllMetro': 'metro',
                'toggleAllToei': 'toei',
                'toggleAllJR': 'jr',
                'toggleAllPrivate': 'private',
                'toggleAllShinkansen': 'shinkansen',
            };
            
            for (const [btnId, prefix] of Object.entries(toggles)) {
                document.getElementById(btnId).addEventListener('click', () => toggleCategory(prefix));
            }
            
            document.getElementById('toggleAllAirplane').addEventListener('click', () => {
                lineVisibility['airplane'] = !lineVisibility['airplane'];
                document.querySelector(`[data-line="airplane"]`).checked = lineVisibility['airplane'];
                updateVisibility();
            });
            
            document.getElementById('hideAllLines').addEventListener('click', () => {
                for (const key in lineVisibility) {
                    lineVisibility[key] = false;
                }
                document.querySelectorAll('.line-toggle').forEach(el => el.checked = false);
                updateVisibility();
            });
        }

        function toggleCategory(prefix) {
            const keys = Object.keys(lineVisibility).filter(k => k.startsWith(prefix + '_'));
            const allOn = keys.every(k => lineVisibility[k]);
            keys.forEach(k => {
                lineVisibility[k] = !allOn;
                const el = document.querySelector(`[data-line="${k}"]`);
                if (el) el.checked = !allOn;
            });
            updateVisibility();
        }

        // ========================================
        // é€Ÿåº¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        // ========================================
        document.getElementById('speedControl').addEventListener('input', (e) => {
            CONFIG.timeScale = parseInt(e.target.value);
            document.getElementById('speedLabel').textContent = CONFIG.timeScale + 'x';
            document.getElementById('timeScaleInfo').textContent = 
                CONFIG.timeScale === 1 ? '1xï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰' : 
                `${CONFIG.timeScale}xï¼ˆ${CONFIG.timeScale}åˆ†/ç§’ï¼‰`;
        });

        // ========================================
        // ãƒ“ãƒ¥ãƒ¼ãƒªã‚»ãƒƒãƒˆ
        // ========================================
        document.getElementById('resetView').addEventListener('click', () => {
            map.setView([35.6812, 139.7671], 12);
        });

        // ========================================
        // åˆæœŸåŒ–
        // ========================================
        generateLineList();
        drawRoutes();
        generateVehicles();
        createMarkers();
        setupCategoryToggles();
        updateVisibility();
        updateTime();

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
        setInterval(updatePositions, CONFIG.updateInterval);
        setInterval(updateTime, 1000);

        console.log('ğŸšƒ æ±äº¬äº¤é€šãƒˆãƒ©ãƒƒã‚«ãƒ¼èµ·å‹•å®Œäº†');
        console.log(`ğŸ“Š ç·è»Šä¸¡æ•°: ${vehicles.length}`);
        console.log(`ğŸ›¤ï¸ è·¯ç·šãƒ‡ãƒ¼ã‚¿: æ±äº¬ãƒ¡ãƒˆãƒ­${Object.keys(railwayData.metro).length}è·¯ç·šã€éƒ½å–¶${Object.keys(railwayData.toei).length}è·¯ç·šã€JR${Object.keys(railwayData.jr).length}è·¯ç·šã€ç§é‰„${Object.keys(railwayData.private).length}è·¯ç·šã€æ–°å¹¹ç·š${Object.keys(railwayData.shinkansen).length}è·¯ç·š`);
    </script>
</body>
</html>
