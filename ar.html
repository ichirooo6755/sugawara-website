<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>AR 3D Model Viewer | SGWR</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <!-- Import model-viewer -->
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
  <style>
    html,
    body {
      height: 100dvh; /* Dynamic Viewport Height for Mobile */
      width: 100%;
      background: #000000;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    model-viewer {
      width: 100%;
      height: 100%;
      background-color: #000000;
      --poster-color: transparent;
    }

    /* Liquid Glass Effect */
    .liquid-glass {
      background: linear-gradient(135deg,
          rgba(255, 255, 255, 0.15) 0%,
          rgba(255, 255, 255, 0.05) 50%,
          rgba(255, 255, 255, 0.1) 100%);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow:
        0 8px 32px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        inset 0 -1px 0 rgba(255, 255, 255, 0.1);
    }
    
    /* Custom AR Button styling to match Liquid Glass */
    .ar-button {
      background-color: white;
      border-radius: 40px;
      border: none;
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      padding: 0px 24px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      font-family: sans-serif;
      font-weight: bold;
      font-size: 14px;
      color: #333;
      cursor: pointer;
      z-index: 100;
    }
    
    .ar-button:active {
      transform: translateX(-50%) scale(0.95);
    }

    /* Hide default AR button since we customize slots */
    model-viewer::part(default-ar-button) {
      display: none; 
    }
  </style>
</head>

<body class="text-white">

  <!-- UI Header -->
  <div class="fixed top-6 left-1/2 -translate-x-1/2 z-50 w-full max-w-sm px-4">
    <div class="liquid-glass rounded-2xl px-5 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <a href="3d-control/index.html" class="bg-white/10 p-2 rounded-full hover:bg-white/20 transition">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
        </a>
        <span class="text-sm font-medium text-white/90 tracking-wide">AR View</span>
      </div>
      
      <!-- Hidden file input for custom load if needed later -->
      <label for="modelFile" class="cursor-pointer opacity-80 hover:opacity-100">
         <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
         </svg>
      </label>
      <input id="modelFile" type="file" accept=".glb,.gltf" class="hidden" />
    </div>
  </div>

  <!-- Model Viewer -->
  <!-- 
    src: Path to model
    ar: Enables AR
    ar-modes: webxr scene-viewer quick-look (Order matters: WebXR preferred, then Android native, then iOS native)
    camera-controls: Mouse/Touch rotate
    shadow-intensity: Shadow on ground
    auto-rotate: Idle spin
  -->
  <model-viewer
    id="viewer"
    src="3d-control/model.glb"
    scale="0.01 0.01 0.01"
    poster="https://placehold.co/1080x1920/000000/FFFFFF/png?text=Loading+AR+Model..."
    alt="3D Model"
    ar
    ar-scale="auto"
    ar-placement="floor"
    ar-modes="webxr scene-viewer quick-look"
    camera-controls
    shadow-intensity="0.5"
    exposure="1.5"
    environment-image="neutral"
    auto-rotate
    auto-rotate-delay="2000"
  >
    <!-- Custom AR Button (Slot) -->
    <button slot="ar-button" class="ar-button">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5" />
      </svg>
      VIEW IN YOUR SPACE
    </button>
    
    <div slot="progress-bar" class="w-full h-1 bg-white/20 absolute top-0">
       <div class="h-full bg-yellow-400 transition-all duration-100" id="progress"></div>
    </div>
  </model-viewer>

  <script>
    const viewer = document.querySelector('#viewer');
    const fileInput = document.querySelector('#modelFile');
    const progress = document.querySelector('#progress');

    // Handle Custom File Load
    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        viewer.src = url;
      }
    });

    // Tint Model Logic
    viewer.addEventListener('load', () => {
      const model = viewer.model;
      if (model && model.materials) {
        model.materials.forEach(material => {
          // Set to Yellow [R, G, B, A]
          material.pbrMetallicRoughness.setBaseColorFactor([1.0, 1.0, 0.0, 1.0]);
          material.pbrMetallicRoughness.setRoughnessFactor(0.2);
          material.pbrMetallicRoughness.setMetallicFactor(0.8);
        });
      }
    });

    // Progress Bar
    viewer.addEventListener('progress', (e) => {
      const percent = e.detail.totalProgress * 100;
      progress.style.width = `${percent}%`;
      if (percent >= 100) {
        setTimeout(() => progress.style.opacity = '0', 500);
      } else {
        progress.style.opacity = '1';
      }
    });
    
  </script>

</body>
</html>
